<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Race Track</title>
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script>
    // Auto Controls
    AFRAME.registerComponent('car-controller', {
      schema: {
        speed: { type: 'number', default: 0 },
        acceleration: { type: 'number', default: 0.05 },
        braking: { type: 'number', default: 0.1 },
        maxSpeed: { type: 'number', default: 1 }
      },
      init: function () {
        this.direction = new THREE.Vector3(0, 0, -1); // Forward direction
        this.rotation = 0; // Rotation for turning
        this.el.sceneEl.addEventListener('controllerconnected', (evt) => {
          this.controller = evt.detail.component.el;
        });
      },
      tick: function (time, timeDelta) {
        if (!this.controller) return;

        // Controller Buttons von der Quest
        const input = this.controller.components;
        if (input && input['oculus-touch-controls']) {
          const buttons = input['oculus-touch-controls'].buttonStates;
          const joystick = input['oculus-touch-controls'].axis;

          // "A" = nach vorne fahren
          if (buttons[0].pressed) {
            this.data.speed = Math.min(this.data.maxSpeed, this.data.speed + this.data.acceleration);
          }

          // "B" = stoppen
          if (buttons[1].pressed) {
            this.data.speed = Math.max(0, this.data.speed - this.data.braking);
          }

          // linker Joystick = Richtung Ã¤ndern
          this.rotation += joystick[0] * -0.05;
          this.direction.set(0, 0, -1).applyAxisAngle(new THREE.Vector3(0, 1, 0), this.rotation);
        }

        // Autoposition updateb
        const move = this.direction.clone().multiplyScalar(this.data.speed * timeDelta / 1000);
        this.el.object3D.position.add(move);
        this.el.object3D.rotation.y = this.rotation;
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <!-- track -->
    <a-ring 
      position="0 0 0" 
      radius-inner="5" 
      radius-outer="5.5" 
      color="gray" 
      rotation="-90 0 0">
    </a-ring>

    <!-- car -->
    <a-box 
      id="car" 
      position="0 0.5 -5" 
      rotation="0 0 0" 
      color="red" 
      depth="1" 
      height="0.5" 
      width="0.5" 
      car-controller>
    </a-box>

    <!-- environment -->
    <a-light type="ambient" color="#FFF"></a-light>
    <a-light type="directional" position="0 5 0" intensity="1"></a-light>
    <a-camera position="0 1.6 10" wasd-controls="enabled: false">
      <a-entity 
        oculus-touch-controls="hand: left"></a-entity>
      <a-entity 
        oculus-touch-controls="hand: right"></a-entity>
    </a-camera>
  </a-scene>
</body>
</html>